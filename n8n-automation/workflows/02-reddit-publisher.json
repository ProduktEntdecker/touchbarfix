{
  "name": "Reddit Publisher",
  "nodes": [
    {
      "parameters": {
        "path": "content-ready",
        "responseMode": "responseNode",
        "responseData": "json",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Content Ready Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [200, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.approved}}",
              "operation": "equal",
              "value2": true
            }
          ]
        }
      },
      "id": "check-approval",
      "name": "Check if Approved",
      "type": "n8n-nodes-base.if",
      "position": [400, 300]
    },
    {
      "parameters": {
        "functionCode": "// Add random delay to appear human\nconst delays = [120, 180, 240, 300]; // 2-5 minutes in seconds\nconst randomDelay = delays[Math.floor(Math.random() * delays.length)];\n\n// Subreddit rotation logic\nconst dayOfWeek = new Date().getDay();\nconst subreddits = {\n  1: 'MacBookPro',  // Monday\n  2: 'Mac',         // Tuesday  \n  3: 'macOS',       // Wednesday\n  4: 'applehelp',   // Thursday\n  5: 'MacBookPro'   // Friday\n};\n\nconst targetSubreddit = subreddits[dayOfWeek] || 'MacBookPro';\n\nreturn {\n  ...item.json,\n  delay: randomDelay,\n  subreddit: targetSubreddit,\n  postTime: new Date(Date.now() + (randomDelay * 1000)).toISOString()\n};"
      },
      "id": "prepare-post",
      "name": "Prepare Post Details",
      "type": "n8n-nodes-base.function",
      "position": [600, 200]
    },
    {
      "parameters": {
        "amount": "={{$json.delay}}",
        "unit": "seconds"
      },
      "id": "random-delay",
      "name": "Random Human Delay",
      "type": "n8n-nodes-base.wait",
      "position": [800, 200]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "url": "https://oauth.reddit.com/api/submit",
        "sendHeaders": true,
        "headers": {
          "User-Agent": "TouchBarFixBot/1.0 by u/YourUsername"
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "api_type",
              "value": "json"
            },
            {
              "name": "kind",
              "value": "self"
            },
            {
              "name": "sr",
              "value": "={{$json.subreddit}}"
            },
            {
              "name": "title", 
              "value": "={{$json.title}}"
            },
            {
              "name": "text",
              "value": "={{$json.content}}"
            },
            {
              "name": "send_replies",
              "value": "true"
            }
          ]
        }
      },
      "id": "post-to-reddit",
      "name": "Post to Reddit",
      "type": "n8n-nodes-base.httpRequest",
      "position": [1000, 200]
    },
    {
      "parameters": {
        "operation": "update",
        "sheetId": "YOUR_SHEET_ID",
        "range": "ContentDatabase!A:H",
        "options": {
          "valueInputOption": "USER_ENTERED"
        },
        "dataMode": "autoMapInputData"
      },
      "id": "update-status",
      "name": "Update Post Status",
      "type": "n8n-nodes-base.googleSheets",
      "position": [1200, 200]
    },
    {
      "parameters": {
        "functionCode": "// Log rejection for analysis\nconsole.log('Content rejected:', item.json.title);\nconsole.log('Quality score:', item.json.qualityScore);\n\nreturn {\n  ...item.json,\n  status: 'rejected',\n  reason: 'Quality score below threshold'\n};"
      },
      "id": "handle-rejection",
      "name": "Handle Rejection",
      "type": "n8n-nodes-base.function",
      "position": [600, 400]
    },
    {
      "parameters": {
        "fromEmail": "noreply@touchbarfix.com",
        "toEmail": "YOUR_EMAIL@domain.com",
        "subject": "Content Rejected - Manual Review Needed",
        "text": "Content was rejected for posting:\\n\\nTitle: {{$json.title}}\\nScore: {{$json.qualityScore}}\\nReason: {{$json.reason}}\\n\\nPlease review and adjust content templates if needed."
      },
      "id": "alert-rejection",
      "name": "Send Rejection Alert",
      "type": "n8n-nodes-base.emailSend",
      "position": [800, 400]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "check-approval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-approval": {
      "main": [
        [
          {
            "node": "prepare-post",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "handle-rejection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare-post": {
      "main": [
        [
          {
            "node": "random-delay",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "random-delay": {
      "main": [
        [
          {
            "node": "post-to-reddit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "post-to-reddit": {
      "main": [
        [
          {
            "node": "update-status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "handle-rejection": {
      "main": [
        [
          {
            "node": "alert-rejection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionTimeout": 600,
    "saveExecutionProgress": true,
    "saveDataSuccessExecution": "all"
  }
}