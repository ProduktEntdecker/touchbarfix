{
  "name": "Performance Monitor",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "id": "check-every-4h",
      "name": "Check Every 4 Hours",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [200, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "sheetId": "YOUR_SHEET_ID",
        "range": "ContentDatabase!A:H"
      },
      "id": "get-recent-posts",
      "name": "Get Recent Posts",
      "type": "n8n-nodes-base.googleSheets",
      "position": [400, 300]
    },
    {
      "parameters": {
        "functionCode": "// Filter posts from last 24 hours with Reddit URLs\nconst oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\nconst recentPosts = items.filter(item => {\n  const postTime = new Date(item.json.timestamp);\n  return postTime > oneDayAgo && item.json.reddit_url;\n});\n\nconsole.log(`Found ${recentPosts.length} recent posts to check`);\n\nreturn recentPosts;"
      },
      "id": "filter-recent",
      "name": "Filter Recent Posts",
      "type": "n8n-nodes-base.function",
      "position": [600, 300]
    },
    {
      "parameters": {
        "url": "={{$json.reddit_url}}.json",
        "options": {
          "headers": {
            "User-Agent": "TouchBarFix Analytics Bot 1.0"
          }
        }
      },
      "id": "fetch-metrics",
      "name": "Fetch Reddit Metrics", 
      "type": "n8n-nodes-base.httpRequest",
      "position": [800, 300]
    },
    {
      "parameters": {
        "functionCode": "// Extract engagement metrics\nconst postData = $input.item.json[0].data.children[0].data;\n\nconst metrics = {\n  post_id: item.json.post_id,\n  upvotes: postData.ups,\n  downvotes: postData.downs, \n  comments: postData.num_comments,\n  score: postData.score,\n  upvote_ratio: postData.upvote_ratio,\n  created_utc: postData.created_utc,\n  engagement_rate: (postData.ups + postData.num_comments) / Math.max(postData.view_count || 100, 100),\n  is_viral: postData.ups > 50 || postData.num_comments > 20,\n  check_time: new Date().toISOString()\n};\n\nconsole.log(`Post performance: ${metrics.upvotes} upvotes, ${metrics.comments} comments`);\n\nif (metrics.is_viral) {\n  console.log('ðŸš€ VIRAL CONTENT DETECTED!');\n}\n\nreturn {\n  ...item.json,\n  ...metrics\n};"
      },
      "id": "calculate-metrics",
      "name": "Calculate Engagement",
      "type": "n8n-nodes-base.function",
      "position": [1000, 300]
    },
    {
      "parameters": {
        "operation": "update",
        "sheetId": "YOUR_SHEET_ID", 
        "range": "ContentDatabase!A:M",
        "options": {
          "valueInputOption": "USER_ENTERED"
        },
        "dataMode": "autoMapInputData"
      },
      "id": "update-metrics",
      "name": "Update Metrics Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "position": [1200, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.is_viral}}",
              "operation": "equal",
              "value2": true
            }
          ]
        }
      },
      "id": "check-viral",
      "name": "Check if Viral",
      "type": "n8n-nodes-base.if",
      "position": [1000, 450]
    },
    {
      "parameters": {
        "path": "viral-content",
        "responseMode": "lastNode", 
        "responseData": "json"
      },
      "id": "trigger-repurpose",
      "name": "Trigger Repurpose",
      "type": "n8n-nodes-base.webhook",
      "position": [1200, 400]
    },
    {
      "parameters": {
        "fromEmail": "alerts@touchbarfix.com",
        "toEmail": "YOUR_EMAIL@domain.com",
        "subject": "ðŸš€ Viral Content Alert - TouchBarFix",
        "html": "<h2>Viral Content Detected!</h2><p><strong>Title:</strong> {{$json.title}}</p><p><strong>Metrics:</strong></p><ul><li>Upvotes: {{$json.upvotes}}</li><li>Comments: {{$json.comments}}</li><li>Engagement Rate: {{$json.engagement_rate}}%</li></ul><p><strong>Reddit URL:</strong> <a href='{{$json.reddit_url}}'>View Post</a></p><p>This content should be repurposed across other platforms!</p>"
      },
      "id": "viral-alert",
      "name": "Send Viral Alert",
      "type": "n8n-nodes-base.emailSend", 
      "position": [1400, 400]
    }
  ],
  "connections": {
    "check-every-4h": {
      "main": [
        [
          {
            "node": "get-recent-posts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-recent-posts": {
      "main": [
        [
          {
            "node": "filter-recent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "filter-recent": {
      "main": [
        [
          {
            "node": "fetch-metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fetch-metrics": {
      "main": [
        [
          {
            "node": "calculate-metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calculate-metrics": {
      "main": [
        [
          {
            "node": "update-metrics",
            "type": "main",
            "index": 0
          },
          {
            "node": "check-viral",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-viral": {
      "main": [
        [
          {
            "node": "trigger-repurpose",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "trigger-repurpose": {
      "main": [
        [
          {
            "node": "viral-alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionTimeout": 300,
    "saveExecutionProgress": true,
    "saveDataSuccessExecution": "all"
  }
}